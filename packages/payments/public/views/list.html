<section data-ng-controller="PaymentsController" data-ng-init="find()">
  
  <form class="form-inline" role="form">
    <div class="form-group">
      <div class="input-group col-sm-4">
        <div class="input-group-addon">Search <span class="glyphicon glyphicon-search search-icon"></span></div>
        <input class="form-control" type="text" placeholder="Search client name" ng-model="searchSelected" typeahead="item.clientName for item in clients | filter:$viewValue | limitTo:8">
      </div>
    </div>
  </form>

  <hr />
  <div>
    <div class="col-sm-3">
      <button type="button" class="btn btn-sm btn-info" ng-click="moveWeek(-1)"><i class="glyphicon glyphicon-chevron-left"></i></button>
      <button type="button" class="btn btn-sm btn-default" ng-disabled="true">{{dateRange}}</button>
      <button type="button" class="btn btn-sm btn-info" ng-click="moveWeek(1)"><i class="glyphicon glyphicon-chevron-right"></i></button>
    </div>
    <tabset class="panel col-sm-9">
      <tab heading="Payments Dashboard" >
        <!-- <div class="col-sm-4"> -->
          <div class="panel panel-info">
            <!-- <div class="panel-heading">Payments Dashboard</div> -->
            <table class="table text-right">
              <tr ng-repeat="payDash in paymentsDashboard">
                <td>
                  <span class="pull-left"><strong>{{payDash.label}}</strong></span>
                </td>
                <td>
                  <span>{{payDash.name}}</span>
                </td>
                <td>
                  <span class="pull-left">{{payDash.value}}</span>
                </td>
              </tr>
            </table>
          </div>
        <!-- </div> -->
      </tab>

      <tab heading="Officers Dashboard" >
        <!-- <div class="col-sm-5"> -->
          <div class="panel panel-success">
            <!-- <div class="panel-heading">Officers Dashboard</div> -->
            <table class="table text-center">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>{{NOW.monthDate}}</th>
                  <th>Week #{{NOW.week}}</th>
                  <th>{{NOW.month}}</th>
                  <th>{{NOW.year}}</th>
                </tr>
              </thead>
              <tr ng-repeat="offDash in officersDashboard">
                <td>
                  <span ><strong>{{offDash.label}}</strong></span>
                </td>
                <td>
                  <span></span>
                </td>
                <td>
                  <span class="pull-left"></span>
                </td>
                <td></td>
                <td>{{officersDashboard[offDash.id].year}}</td>
              </tr>
            </table>
          </div>
        <!-- </div> -->
      </tab>

    </tabset>
  </div>

  <table class="table table-striped text-center payments">
    <thead>
      <tr>
        <th class="text-center col-sm-2">Client Name</th>
        <th class="text-center col-sm-2">Loan Officer</th>
        <th class="col-sm-1" ng-repeat="day in weeks track by $index">{{day.label}}</th>
        <th>Outstanding Balance</th>
        <th>Payments Total</th>
        <!-- <th>Outstanding - Payments</th> -->
      </tr>
    </thead>
    <tbody>
      <tr class="text-left " ng-repeat="client in clients | filter:searchSelected track by $index">
        <td class="text-center col-sm-2"><a data-ng-href="#!/clients/{{client.client._id}}">{{client.client.clientName}}</a></td>
        <!-- <td class="text-left col-sm-2">
          <select class="form-control" 
            ng-model="clients[client._id]" 
            ng-options="item as item.name for item in loanOfficers" 
            required>
          </select>
        </td> -->
        <td class="text-center">
          <a data-ng-href="#!/users/{{client.client.loanOfficer._id}}">{{client.client.loanOfficer.name}}</a>
          <!-- <select name="client.loanOfficer" class="form-control" 
            ng-model="client.loanOfficer" 
            ng-options="item as item.name for item in loanOfficers" 
            ng-class="{'has-error' : submitted }"
            required>
            <option value="">Loan Officer</option>
          </select> -->
          <!-- <a data-ng-href="#!/clients/{{client._id}}/payments" ng-hide="true" tooltip="View payments history of {{client.clientName}}" tooltip-placement="top">History</a>
          
          <form ngForm name="clientForm" class="form-inline" role="form" data-ng-submit="create(clientForm.$valid, client, client.paymentData.loanOfficer)" novalidate>
            <select name="client.paymentData.loanOfficer" class="form-control" 
              ng-model="client.paymentData.loanOfficer" 
              ng-options="item as item.name for item in loanOfficers" 
              ng-class="{'has-error' : submitted }"
              required>
              <option value="">Loan Officer</option>
            </select>
            <div ng-repeat="form in client.payments" ng-class="{'has-error' : submitted }">
              <input type="text" ng-model="form.paidAmount" ng-change="paid(client)" required>
              <input type="text" ng-model="form.date" 
                datepicker-popup="yyyy/MM/dd"
                init-date="initDate"
                is-open="clientForm.form.date[$index].open"
                ng-click="clientForm.form.date[$index].open = true"
                min-date="minDate"
                max-date="maxDate"
                datepicker-options="dateOptions"
                date-disabled="disabled(date, mode)" 
                ng-required="true"
                close-text="Close"
                placeholder="yyyy/MM/dd"
                required>
              <i class="glyphicon glyphicon-remove btn" tooltip="Remove" tooltip-placement="right" ng-click="removeField(client, $index)"></i>
            </div>
            <button type="submit" ng-disabled="client.payments.length == 0" class="btn btn-primary btn-sm" >Save</button>
            <button type="button" class="btn btn-success btn-sm" tooltip="Add payments" tooltip-placement="right" ng-click="addField(client)"><i class="glyphicon glyphicon-plus"></i></button>
          </form> -->

        </td>
        <!-- <td>
          <table class="table text-right">
            <tr><td><span class="pull-left"><strong>Outstanding Balance:</strong></span>{{client.outstandingBalance}}</td></tr>
            <tr><td><span class="pull-left"><strong>Payments:</strong></span>{{paymentsTotal(client)}}</td></tr>
            <tr><td><span class="pull-left"><strong>Outstanding - Payment:</strong></span>{{nextOutstandingBalance(client)}}</td></tr>
          </table>
        </td> -->
        <td ng-repeat="day in weeks track by $index">
          <input type="text" ng-model="client.payments[day.datetime]" ng-blur="blurPayment(client, day, client.payments[day.datetime])">
          <!-- <input type="text" ng-disabled="!(client.loanOfficer)" ng-model="client.payments[day.datetime]" ng-blur="blurPayment(client.client, client.loanOfficer, day, client.payments[day.datetime])"> -->
        </td>
        <td>{{client.client.summary.outstandingBalance}}</td>
        <td>{{client.client.summary.totalAmountPaid}}</td>
        <!-- <td>{{client.client.summary.outstandingBalance_totalAmountPaid}}</td> -->

      </tr>
    </tbody>
  </table>

</section>
